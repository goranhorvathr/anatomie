<script>
    var _learnq = _learnq || [];
    _learnq.push(['track', 'Viewed Page', {
        'Page URL':'{{ request.path }}'
    }]);

    {% if request.page_type == 'search' %}
        _learnq.push(['track', 'Searched Product', {
            'Search Term':'{{search.terms | downcase}}',
            'Failed Search' : {% if search.results_count > 0 %}false{% else %}true{% endif %}
        }]);
    {% endif %}
</script>

{% if request.page_type == 'product' %}
<script type="text/javascript">
    var _learnq = _learnq || [];
    var item = {
      Name: {{ product.title | json }},
      ProductID: {{ product.id | json }},
      Categories: {{ product.collections | map:'title' | json }},
      ImageURL: "https:{{ product.featured_image.src | img_url:'grande' }}",
      URL: "{{ shop.secure_url }}{{ product.url }}",
      Brand: {{ product.vendor | json }},
      Price: {{ product.price | money | json }},
      CompareAtPrice: {{ product.compare_at_price_max | money | json }}
    };
    _learnq.push(['track', 'Viewed Product', item]);
    _learnq.push(['trackViewedItem', {
      Title: item.Name,
      ItemId: item.ProductID,
      Categories: item.Categories,
      ImageUrl: item.ImageURL,
      Url: item.URL,
      Metadata: {
        Brand: item.Brand,
        Price: item.Price,
        CompareAtPrice: item.CompareAtPrice
      }
    }]);
  </script>
{% endif %}