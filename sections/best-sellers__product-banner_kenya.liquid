<script type="text/javascript" src="{{ 'slick-custom.min.js' | asset_url }}" defer="defer"></script>
<script type="text/javascript">
   document.addEventListener('DOMContentLoaded', function () {
      $('.product-media').slick({
         arrows: true,
         dots: false,
         infinite: true,
         slidesToShow: 1,
         slidesToScroll: 1,
         responsive: [
            {
            breakpoint: 768,
            settings: {
               centerMode: true,
            }
         },
       ]
      });
   });
</script>

<section class="featured-product" data-section-id="{{ section.id }}">
   {% assign product = all_products[section.settings.product] %}
   <div class="product-banner {% if section.settings.image_align == 'left' %}image-left{% endif %}">
      <div class="product-text-container">
         <div class="product-content text-center">
            <h3 class="product-title heading-lg">{{ product.title }}</h3>

            <div class="product-rating">
               {% render 'judgeme_widgets', widget_type: 'judgeme_preview_badge', jm_style: '', concierge_install: false, product: product %}
            </div>

            <div class="product-des text-md">
               {% if section.settings.enable_description %}
                  {{ section.settings.custom_description }}
               {% else %}
                  {{ product.content }}
               {% endif %}
            </div>

            <div class="product-color">
               {% if settings.swatch_enabled %}
               {%- for option in product.options -%}
               {%- if option == settings.swatch_option_name -%}
               {%- capture value_key -%}option{{ forloop.index }}{%- endcapture -%}
               {%- capture colours -%},{%- endcapture -%}
               {%- for variant in product.variants -%}
               {%- capture colour_compare -%},{{ variant[value_key] }},{%- endcapture -%}
               {%- unless colours contains colour_compare -%}
               {%- capture colours -%}{{ colours }}{{ variant[value_key] }},{%- endcapture -%}
               {%- endunless -%}
               {%- endfor -%}

               {%- assign colours = colours | split: ',' -%}
               {%- assign non_blank_colours = 0 -%}
               {%- if settings.swatch_method == 'images' -%}
               {% style %}
               {%- for colour in colours -%}
                  {%- unless colour == blank -%}
                     {%- assign non_blank_colours = non_blank_colours | plus: 1 -%}
                     {%- if settings.variant_style == 'listed' -%}
                        select[data-colour-swatch="true"] + .clickyboxes .opt--{{ colour | handle }}::after {
                           background-image: url({{ 'color-' | append: colour | handle | append: '.png' | file_img_url }});
                        }
                     {%- else -%}
                        .select2-container .swatch-option__nugget.bg-{{ colour | handle }} {
                           background-image: url({{ 'color-' | append: colour | handle | append: '.png' | file_img_url }});
                        }
                     {%- endif -%}
                  {%- endunless -%}
               {%- endfor -%}
               {% endstyle %}
               {%- else -%}
               {%- for colour in colours -%}
               {%- unless colour == blank -%}{%- assign non_blank_colours = non_blank_colours | plus: 1 -%}{%- endunless -%}
               {%- endfor -%}
               {%- endif -%}
               <div class="product-swatch-inline" data-swatch-count="{{ non_blank_colours }}">
                  <div class="color-counter text-weight-md">
                     {% assign a = colours.size | minus: 1 %}
                     <span>available {% if a > 1 %}in {{ a }} colors{% endif %}</span>
                  </div>
                  {%- for colour in colours -%}
                  {% unless colour == blank %}
                  <span class="product-swatch-inline__dot bg-{{ colour | handle }}"
                     {% if settings.swatch_method == 'images' %}style="background-image: url({{ 'color-' | append: colour | handle | append: '.png' | file_img_url }})"
                     {% endif %}></span>
                  {% endunless %}
                  {%- endfor -%}
               </div>
               {%- endif -%}
               {%- endfor -%}
               {% endif %}
            </div>

            <div class="product-price">

               {% if product.price_varies %}
               <span class="product-price__from">{{ 'products.product.from_text' | t }}</span>
               {% endif %}

               {% if product.compare_at_price > product.price %}
               <span {% comment %} START Global-e VAT tag {% endcomment %}
                  {% if product.selected_or_first_available_variant.taxable == false %}data-product-vat="0" {% endif %}
                  {% if product.selected_or_first_available_variant.metafields.GlobalE.product_meta != blank %}
                  data-product-meta='{{product.selected_or_first_available_variant.metafields.GlobalE.product_meta | json | escape}}'
                  {% endif %} {% comment %}END Global-e VAT tag {% endcomment %}
                  class="product-price__reduced theme-money">
                  {{ product.price | money }}
               </span>
               {% else %}
               <span {% comment %} START Global-e VAT tag {% endcomment %}
                  {% if product.selected_or_first_available_variant.taxable == false %}data-product-vat="0" {% endif %}
                  {% if product.selected_or_first_available_variant.metafields.GlobalE.product_meta != blank %}
                  data-product-meta='{{product.selected_or_first_available_variant.metafields.GlobalE.product_meta | json | escape}}'
                  {% endif %} {% comment %}END Global-e VAT tag {% endcomment %}
                  class="theme-money">{{ product.price | money }}</span>
               {% endif %}

               {% if product.compare_at_price > product.price %}
               <span class="visually-hidden">{{ 'products.product.regular_price' | t }}</span>
               <span {% comment %} START Global-e VAT tag {% endcomment %}
                  {% if product.selected_or_first_available_variant.taxable == false %}data-product-vat="0" {% endif %}
                  {% if product.selected_or_first_available_variant.metafields.GlobalE.product_meta != blank %}
                  data-product-meta='{{product.selected_or_first_available_variant.metafields.GlobalE.product_meta | json | escape}}'
                  {% endif %} {% comment %}END Global-e VAT tag {% endcomment %}
                  class="product-price__compare theme-money">{{ product.compare_at_price | money }}</span>
               {% endif %}

               {%- assign variant = product.variants | sort: 'price' | first -%}
               {%- if variant.unit_price_measurement -%}
               {%- capture unit_price_base_unit -%}
               {%- if variant.unit_price_measurement.reference_value != 1 -%}
               {{- variant.unit_price_measurement.reference_value -}}
               {%- endif -%}
               {{ variant.unit_price_measurement.reference_unit }}
               {%- endcapture -%}
               <div class="unit-price small-text">
                  <span {% comment %} START Global-e VAT tag {% endcomment %}
                     {% if variant.taxable == false %}data-product-vat="0" {% endif %}
                     {% if variant.metafields.GlobalE.product_meta != blank %}
                     data-product-meta='{{variant.metafields.GlobalE.product_meta | json | escape}}' {% endif %}
                     {% comment %}END Global-e VAT tag {% endcomment %}
                     class="unit-price__price theme-money">{{ variant.unit_price | money }}</span>
                  <span class="unit-price__separator">{{ 'products.product.unit_price_separator' | t }}</span>
                  <span class="unit-price__unit">{{ unit_price_base_unit }}</span>
               </div>
               {%- endif -%}

               {% if product.available %}
               {% if product.compare_at_price_max > product.price and settings.sale_label_enabled %}
               <span
                  class="product-label product-label--on-sale global-border-radius">{{ 'products.product.on_sale' | t }}</span>
               {% endif %}
               {% elsif settings.sold_label_enabled %}
               <span
                  class="product-label product-label--sold-out global-border-radius">{{ 'products.product.sold_out' | t }}</span>
               {% endif %}

            </div>

            {% if section.settings.button_text != blank %}
            <a class="btn btn--secondary mt-sm product-content-btn"
               href="{{ product.url }}">{{ section.settings.button_text }}</a>
            {% endif %}
         </div>
      </div>
      <div class="product-media-container">

         <div class="product-media">
            {% if section.settings.enable_gallery %}
               {% for block in section.blocks %}
                  <div class="slide">
                     <img class="image--one-half product-image--desktop"
                        src="{{ block.settings.desktop_image | img_url: '800x' }}" alt="{{ image.alt | escape }}">
                     {% if block.settings.mobile_image != blank %}
                     <img class="image--one-half product-image--mobile" src="{{ block.settings.mobile_image | img_url: '800x' }}"
                        alt="{{ image.alt | escape }}">
                     {% else %}
                     <img class="image--one-half product-image--mobile"
                        src="{{ block.settings.desktop_image | img_url: '800x' }}" alt="{{ image.alt | escape }}">
                     {% endif %}
                  </div>
               {% endfor %}
            {% else %}
               {% if product.images.size > 0 %}
                  {% if product.images.size > 1 %}
                     {% for image in product.images %}
                     <div class="slide">
                        <img class="image--one-half" src="{{ image | img_url: '400x620' }}" data-src="{{ img_url }}"
                           data-sizes="auto" data-parent-fit="cover" alt="{{ image.alt | escape }}">
                     </div>
                     {% endfor %}
                  {% else %}
                     <img class="image--one-half" src="{{ product.images[0] | img_url: '400x620' }}"
                        alt="{{ image.alt | escape }}">
                  {% endif %}
               {% else %}
                  <div class="featured-product-image-link">
                     {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
                  </div>
               {% endif %}
            {% endif %}
         </div>
      </div>
   </div>

</section>

{% schema %}
  {
    "name": "Kenya Product Banner",
    "class": "custom-featured-product",
    "settings": [
      {
        "type": "product",
        "id": "product",
        "label": "Select Product"
      },
      {
        "type": "radio",
        "id": "image_align",
        "label": "Image Left/Right",
        "default": "left",
        "options": [
          {
            "value": "left",
            "label": "Left"
          },
          {
            "value": "right",
            "label": "Right"
          }
        ]
      },
      {
        "type": "checkbox",
        "id": "enable_description",
        "label": "Enable Custom description",
        "default": false
      },
      {
        "type": "richtext",
        "id": "custom_description",
        "label": "Custom Description"
      },
      {
        "type": "text",
        "id": "button_text",
        "label": "Button Text"
      },
      {
        "type": "checkbox",
        "id": "enable_gallery",
        "label": "Enable Custom Gallery",
        "default": false
      }
    ],
    "blocks": [
      {
         "type": "image",
         "name": "Image",
         "settings": [
            {
               "type": "image_picker",
               "id": "desktop_image",
               "label": "Desktop Image"
            },
            {
               "type": "image_picker",
               "id": "mobile_image",
               "label": "Mobile Image"
            }
         ]
      }
    ]
  }
{% endschema %}